/*! For license information please see kariba.js.LICENSE.txt */
(()=>{"use strict";const e="24",t="exit_intent",n="welcome_push_data",o="page_deactivated",i="page_deactivated_event_sent",a="ActionManager",r="kariba_exit_intent_session_uuid",l="kariba_send_token_kariba_session_uuid",s=1728e5,c={low:{},medium:{scrolling:{sensibility:-200,comparator:"<",timeout:2e3},closeTab:{},reloadPage:{},changeTab:{},mouseOutViewPort:{}},high:{}},d={low:{},medium:{scrolling:{sensibility:350,comparator:">",timeout:2e3},closeTab:{},reloadPage:{},changeTab:{},mouseOutViewPort:{}},high:{}},m={canvasId:"kariba_popup_canvas",numSegments:3,outerRadius:155,innerRadius:16,textFontSize:16,textMargin:0,lineWidth:0,segments:[{fillStyle:"#eae56f",text:"Prize 1",code:"xxx",strokeStyle:"#ffffff"},{fillStyle:"#89f26e",text:"Prize 2",code:"xxx",strokeStyle:"#ffffff"},{fillStyle:"#7de6ef",text:"Prize 3",code:"xxx",strokeStyle:"#ffffff"}]},u=function(e,t){if(!hoian)return void console.warn("did not receive hoian instance...");let n=t;"object"==typeof n&&(n=JSON.stringify(n)),console.log("sending ~ trackingData: ",n);try{return hoian.signal(e,[{ot:n}])}catch(e){return console.warn("sent tracking data fail!"),!1}},g=(e,t)=>{u("25",{node_uuid:e}),t()},p=e=>{u("26",{node_uuid:e})},f=e=>{if(!e)return!1;const t=parseInt(localStorage.getItem(`isPlayed-${e}`));if(console.log("isPlayed ",t),t)return!1;if(parseInt(sessionStorage.getItem(`minigameInSession-${e}`)))return!1;const n=parseInt(localStorage.getItem(`minigame-${e}`));return!n||n<4};const _=e=>!!e.value.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),y=()=>hoian&&"function"==typeof hoian.getTrackingId?hoian.getTrackingId():(console.warn("did not receive hoian instance..."),!1),b=(e,t)=>e?e.replace(/\{\{coupon_title\}\}/g,t):"",x=async(e,t)=>await new Promise((t=>{const n=setInterval((()=>{const o=parseInt(sessionStorage.getItem("timeLogPage"));Date.now()>o+1e3*e&&(clearInterval(n),t(!0))}),1e3)})),k=e=>{const t=sessionStorage.getItem("productsView");if(t){const n=t.split(",");return[...new Set(n)].length>=e}return!1};async function h(e,t){try{const n=await fetch("https://be.juno.kariba.ai/api/v1/action-triggers/public/minigame/email-validator",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,node_uuid:t})});return{status:n.status,msg:await n.json()}}catch(e){return!1}}async function v(e){try{const t=await fetch("https://be.juno.kariba.ai/api/v1/action-triggers/public/minigame",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`Failed to fetch data: ${t.status}`);return t.json()}catch(e){console.log(e)}}const w=e=>{const t=e.map((e=>parseInt(e.rate))),n=(e=>{let t=e.map((e=>{let t=[];for(;t.length<e;)t.push(e);return t})).flat(),n=t[Math.floor(Math.random()*t.length)];return e.indexOf(n)})(t);if(n<0)return null;return 360/t.length*n};let $,I=!1;const S=()=>{document.getElementById("kariba_overlay_container")?.remove(),document.getElementById("kariba_result_container_result")?.remove(),document.getElementById("kariba_spin_game")?.remove(),document.getElementById("kariba_spin_game_minimize")?.remove()},A=e=>{if("Confetti"===e){const e=document.getElementById("kariba_effect_canvas");confetti.create(e,{resize:!0,useWorker:!0})({particleCount:100,spread:160})}else if("Fireworks"===e){const e=document.getElementById("effect_wrapper");e.addEventListener("click",(function(){this.remove()})),$=new Fireworks(e),$.start()}},E=(t,n,o)=>{const i=y(),a=document.getElementById("kariba_minigame_email")?.value,r=o?.background?.effects;o?.background?.effects;document.getElementById("kariba_overlay_container")?.remove(),document.getElementById("kariba_spin_game_minimize")?.remove(),((e,t)=>{const n=e.imgGift?.url||"",o=b(e.text?.content,t.text)||"",i=e.text?.style||{},a=b(e.code?.content,t.text)||"",r=e.code?.style||{},l=b(e.text_2?.content,t.text)||"",s=e.text_2?.style||{},c=e.button?.content||"",d=e.button?.style||{},m=`\n    <div id="kariba_overlay_container">\n      <div id="kariba_result_container_result"\n        style="background: url(${e?.background.url||""}) no-repeat;">\n        <div id="kariba_close_spin_game"><i class="material-icons">&#xe5cd;</i></div>\n        <img id="kariba_spin_gift_image" src=${n} alt="gift image" class="kariba-image-decorator"\n          style="width: 110px; height: 110px; \n          margin-bottom: 33px;" />\n        <span style="font-family: ${i.fontFamily||"Inter"}; \n          color: ${i.color||"#FA541C"};\n          font-size: ${i.fontSize||36}px;\n          font-weight: ${i.fontStyle||"bold"};\n          text-align: ${i.textAlign||"center"};\n          margin-bottom: 16px;\n          width: 600px;\n          max-height: 104px;\n          ">${o}</span>\n\n        <span style="font-family: ${r.fontFamily||"Inter"}; \n          color: ${r.color||"#000000"};\n          font-size: ${r.fontSize||20}px;\n          font-weight: ${r.fontStyle||"bold"};\n          text-align: ${r.textAlign||"center"};\n          width: 600px;\n          margin-bottom: 16px;\n          ">${a}</span>\n\n        <span style="font-family: ${s.fontFamily||"Inter"}; \n          color: ${s.color||"#FA541C"};\n          font-size: ${s.fontSize||20}px;\n          font-weight: ${s.fontStyle||"bold"};\n          text-align: ${s.textAlign||"center"};\n          margin-bottom: 24px;\n          ">${l}</span>\n\n        <button\n          id="kariba_continue_shopping"\n          style="font-family: ${d.fontFamily||"Inter"}; \n          background-color: ${d.backgroundColor||"#FA541C"};\n          color: ${d.color||"#FFF"};\n          font-size: ${d.fontSize||12}px;\n          font-weight: ${d.fontStyle||"nomal"};\n          text-align: ${d.textAlign||"center"};\n          padding: 4px 16px;\n          min-width: 298px;\n          height: 40px;\n          border-radius: 4px;\n          border: none;\n          outline: none;\n          margin-bottom: 15px;\n          cursor: pointer"\n          >${c}</button>\n          <canvas id="kariba_effect_canvas"></canvas>\n      </div>\n      <div id="effect_wrapper"></div>\n    </div>  \n    `;document.body.innerHTML+=m,document.getElementById("kariba_close_spin_game").addEventListener("click",(()=>{document.getElementById("kariba_overlay_container")?.remove()}))})(o,{text:t.text,code:t.code}),localStorage.setItem(`isPlayed-${n?.node_uuid}`,1),A(r);const l={email:a,utm_s:n?.data?.email?.emailData?.utm_source,utm_m:n?.data?.email?.emailData?.utm_medium,utm_c:n?.data?.email?.emailData?.utm_campaign,coupon:t.code,node_uuid:n?.node_uuid,popup_t:3};u(e,l);v({tracking_id:i,node_uuid:n.node_uuid,coupon_code:t.code,email:a}),document.getElementById("kariba_continue_shopping").addEventListener("click",(function(){S(),"Fireworks"===r&&$.stop()}))},z=e=>{const t=e,n=e?.data.mainPopup,o=e?.data.minimize,i=e?.data.result,a=((e,t,n={})=>{const o=e.background?.url||"",i=e.imgArrow?.url||"",a=t.text?.content||"",r=t.text?.style||{},l=`<div id="kariba_wheel_container" class="mobile">\n    <div class="kariba-background-plate">\n        <span class="kariba-arrow-down"></span>\n        <canvas id="kariba_popup_canvas" width="310" height="310"></canvas>\n    </div>\n    <img src=${i} alt="gift image" class="kariba-image-decorator" style="position:absolute;bottom:0px;right:-50px;" />\n  </div>`;return`\n    <div id="kariba_spin_game_minimize" class="hide-class"\n      style="background: url(${o||""}) no-repeat;\n        background-size: cover;\n        background-position: center;">\n        <span\n        style="font-family: ${r.fontFamily||"Inter"};\n          color: ${r.color||"#FA541C"};\n          font-size: ${r.fontSize||14}px;\n          font-weight: ${r.fontStyle||"bold"};"\n        >${a}</span>\n      </div>\n      <div id="kariba_overlay_container">\n        <div id="kariba_spin_game" class="show-class"\n          style="background: url(${o}) no-repeat;\n          background-size: cover;\n          background-position: center;"\n        >\n          <div id="kariba_close_spin_game"><i class="material-icons">&#xe5cd;</i></div>\n          ${l}\n          <div id="kariba_spin_game_input_wrapper" class="spin-game"></div>\n      </div>\n    </div>`})(n,o);let r=document.getElementById("kariba_result_container_result");r&&r.remove(),document.getElementById("kariba_spin_game")||(document.body.innerHTML+=a),p(e?.node_uuid);const l=e=>{const t=document.getElementById("kariba_alert_email");t.style.display="block",t.textContent=e||"Email không hợp lệ"},s=((e,t,n)=>{const o=t?.wheel,i=(o?.wheels||[]).map((e=>({fillStyle:e.color,text:e.title,code:e.code,strokeStyle:"#FFF"})));var a=new Audio("https://storage.cloud.google.com/dreamf-mcm-public-storage/assets/audio/tick.mp3");return{...m,segments:i,numSegments:i.length,animation:{type:"spinToStop",duration:o.movement,spins:8,callbackFinished:t=>E(t,e,n),callbackSound:function(){a.pause(),a.currentTime=0,a.play()},soundTrigger:"pin"}}})(t,n,i),c=new Winwheel(s),d=async e=>{console.log("start spin wheel",n);var t=document.getElementById("kariba_minigame_email");document.getElementById("kariba_alert_email");if(_(t)){const o=await h(t?.value,e);200===o.status?(((e,t)=>{if(console.log("startSpin",t),0==I){const n=w(t?.wheel.wheels);if(n||0===n){const o=360/t?.wheel.wheels.length;let i=n+Math.floor(Math.random()*o);e.animation.stopAngle=i}e.startAnimation(),I=!0}})(c,n),document.getElementById("kariba_alert_email"),document.getElementById("kariba_alert_email").style.display="none"):l(o?.msg?.detail)}else l()},u=((e={})=>{const t=e?.imgGift?.url||"",n=e?.text?.content||"",o=e?.text?.style||{},i=e?.text_1?.content||"",a=e?.text_1?.style||{},r=e?.text_2?.content||"",l=e?.text_2?.style||{},s=e?.input?.content||"",c=e?.input?.style||{},d=e?.input?.errorTextColor||"",m=e?.button?.content||"",u=e?.button?.style||{};return`\n          <img src=${t} alt="gift image"\n            style="width: 100px; height: 100px; \n            align-self: flex-end;" class="kariba-image-decorator" />\n\n          <span class="k-input-item" style="font-family: ${o.fontFamily||"Inter"}; \n                    color: ${o.color||"#FA541C"};\n                    font-size: ${o.fontSize||36}px;\n                    font-weight: ${o.fontStyle||"bold"};\n                    text-align: ${o.textAlign||"left"};">\n            ${n}\n          </span>\n          <span class="k-input-item" style="font-family: ${a.fontFamily||"Inter"}; \n            color: ${a.color||"#FA541C"};\n            font-size: ${a.fontSize||20}px;\n            font-weight: ${a.fontStyle||"bold"};\n            text-align: ${a.textAlign||"left"};\n            ">${i}</span>\n            \n          <span class="k-input-item" style="font-family: ${l.fontFamily||"Inter"}; \n            color: ${l.color||"#FA541C"};\n            font-size: ${l.fontSize||14}px;\n            font-weight: ${l.fontStyle||"bold"};\n            text-align: ${l.textAlign||"left"};\n            ">${r}</span>\n          <input\n              class="k-input-item"\n              id="kariba_minigame_email";\n              placeholder='${s||"Enter email"}'\n              style="font-family: ${c.fontFamily||"Inter"}; \n                color: ${c.color||"#000"};\n                font-size: ${c.fontSize||14}px;\n                font-weight: ${c.fontStyle||"nomal"};\n                text-align: ${c.textAlign||"left"};\n                padding: 9px 16px;\n                height: 40px;\n                border-radius: 4px;\n                margin-bottom: unset;\n                border: 1px solid rgba(0, 0, 0, 0.15);"\n          />\n          <div \n            id="kariba_alert_email" \n            style="font-family: Inter;\n            color: ${d||"#FA541C"};\n            font-size: 22px;\n            font-weight: normal;\n            text-align: left;">Email bạn nhập vào không hợp lệ</div>\n          <button\n            id="start_spin_wheel"\n            class="k-input-item"\n            style="font-family: ${u.fontFamily||"Inter"}; \n            background-color: ${u.backgroundColor||"#FA541C"};\n            color: ${u.color||"#FFF"};\n            font-size: ${u.fontSize||12}px;\n            font-weight: ${u.fontStyle||"nomal"};\n            text-align: ${u.textAlign||"center"};\n            padding: 4px 16px;\n            height: 40px;\n            border-radius: 4px;\n            border: none;\n            outline: none;\n            cursor: pointer;\n            margin-top: 12px;"\n          >${m}</button>`})(n);let f=document.getElementById("kariba_spin_game_input_wrapper");f.innerHTML=f.innerHTML+u,document.getElementById("start_spin_wheel").addEventListener("click",(()=>d(e?.node_uuid))),document.getElementById("kariba_spin_game_minimize").addEventListener("click",(()=>(document.getElementById("kariba_spin_game_minimize").className="hide-class",void(document.getElementById("kariba_overlay_container").className="show-class")))),document.getElementById("kariba_close_spin_game").addEventListener("click",(()=>{return t=e?.node_uuid,document.getElementById("kariba_overlay_container").className="hide-class",document.getElementById("kariba_spin_game_minimize").className="show-class",void g(t,S);var t}))},F=e=>{if(!e)return;if(!f(e?.node_uuid))return;(async()=>{const{timeOnSite:t,products:n,time:o}=e?.data?.mainPopup?.background;if(n>0){if(e?.node_uuid,parseInt(sessionStorage.getItem("countViewProductsPage"))>0){if(await(async(e,t,n)=>await new Promise((n=>{const o=setInterval((()=>{const i=parseInt(sessionStorage.getItem("timeLogPageProduct")),a=parseInt(sessionStorage.getItem("countViewProductsPage"));Date.now()<i+1e3*e?a>=t&&k(t)&&(clearInterval(o),n(!0)):(clearInterval(o),n(!1))}),1e3)})))(o,n,e?.node_uuid))return void setTimeout((()=>{z(e);const t=parseInt(localStorage.getItem(`minigame-${e?.node_uuid}`));sessionStorage.setItem(`minigameInSession-${e?.node_uuid}`,1),localStorage.setItem(`minigame-${e?.node_uuid}`,t?t+1:1),localStorage.setItem("TimeReceivedPopup",Date.now())}),5e3);!1}}if(t>0){const n=await x(t,e?.node_uuid);if(console.log("isOke: ",n),n){z(e),sessionStorage.setItem(`minigameInSession-${e?.node_uuid}`,1);const t=parseInt(localStorage.getItem(`minigame-${e?.node_uuid}`));return void localStorage.setItem(`minigame-${e?.node_uuid}`,t?t+1:1)}!1}})()},B=()=>{document.getElementById("kariba_overlay_container")?.remove(),document.getElementById("kariba_result_container_result_defaultcode")?.remove(),document.getElementById("kariba_default_code")?.remove(),document.getElementById("kariba_default_code_minimize")?.remove()},C=(t,n,o)=>{const i=y(),a=(e=>{if(!e)return"";const{result:t,mainPopup:n}=e,o=b(t.text?.content,n?.default_coupon?.code)||"",i=t.text?.style||{},a=b(t.text_1?.content,n?.default_coupon?.code)||"",r=t.text_1?.style||{},l=t.button?.content||"",s=t.button?.style||{};return`\n    <div id="kariba_result_container_result_defaultcode"\n      style="background: url(${t?.background?.url||""}) no-repeat;\n      position:fixed;\n      background-size: cover;\n      background-position: center;"\n    >\n        <div id="kariba_close_default_code" class="k-m-close-button"\n        style="width:262px;text-align:right;margin-left:32px; cursor:pointer"\n        >\n          <i class="material-icons">&#xe5cd;</i>\n        </div>\n        <span style="font-family: ${i.fontFamily||"Inter"}; \n          color: ${i.color||"#FA541C"};\n          font-size: ${i.fontSize||36}px;\n          font-weight: ${i.fontStyle||"bold"};\n          text-align: ${i.textAlign||"center"};\n          width:262px;\n          margin-bottom: 20px;\n          ">${o}</span>\n\n        <span style="font-family: ${r.fontFamily||"Inter"}; \n          color: ${r.color||"#000000"};\n          font-size: ${r.fontSize||20}px;\n          font-weight: ${r.fontStyle||"bold"};\n          text-align: ${r.textAlign||"center"};\n          width:262px;\n          margin-bottom: 32px;\n          ">${a}</span>\n\n        <button\n          id="kariba_continue_shopping"\n          style="font-family: ${s.fontFamily||"Inter"}; \n          background-color: ${s.backgroundColor||"#FA541C"};\n          color: ${s.color||"#FFF"};\n          font-size: ${s.fontSize||12}px;\n          font-weight: ${s.fontStyle||"nomal"};\n          text-align: ${s.textAlign||"center"};\n          height:40px;\n          min-width: 262px;\n          border-radius: 8px;\n          border: none;\n          outline: none;\n          margin-bottom: 15px;\n          cursor: pointer"\n          >${l}</button>\n          <canvas id="kariba_effect_canvas"></canvas>\n          <div id="effect_wrapper"></div>\n    </div>`})(t),r="Confetti"==t?.background?.effects;let l;document.getElementById("kariba_overlay_container")?.remove(),u(e,{node_uuid:n,email:o?.value,utm_s:t?.email?.emailData?.utm_source,utm_m:t?.email?.emailData?.utm_medium,utm_c:t?.email?.emailData?.utm_campaign,coupon:t?.mainPopup?.default_coupon?.code,popup_type:2});v({node_uuid:n,tracking_id:i,coupon_code:t?.mainPopup?.default_coupon?.code,email:o?.value});if(document.body.innerHTML+=a,document.getElementById("kariba_result_container_result_defaultcode"))if(r){const e=document.getElementById("kariba_effect_canvas");confetti.create(e,{resize:!0,useWorker:!0})({particleCount:100,spread:160})}else{const e=document.getElementById("effect_wrapper");l=new Fireworks(e),l.start()}document.getElementById("kariba_continue_shopping").addEventListener("click",(()=>{B(),!r&&l&&l.stop()}))},T=e=>{let t=document.getElementById("alert_email");t.style.display="block",t.textContent=e||"Email không hợp lệ"},M=()=>{document.getElementById("alert_email").style.display="none"},P=e=>{if(!e)return;if(!f(e?.node_uuid))return;const t=e.data.mainPopup,n=(e.data.minimize,e.data.result,(e=>{const t=e?.background.url||"",n=e?.text?.content||"",o=e?.text?.style||{};return`\n  <div id="kariba_default_code_minimize" class="hide-class"\n    style="background: url(${t||""}) no-repeat;\n      background-size: cover;\n      background-position: center;">\n      <span\n      style="font-family: ${o.fontFamily||"Inter"}; \n        color: ${o.color||"#FA541C"};\n        font-size: ${o.fontSize||14}px;\n        font-weight: ${o.fontStyle||"bold"};"\n      >${n}</span>\n    </div>\n  </div>`})(e?.data?.minimize));document.body.innerHTML+=n;const o=((e={})=>{const t=e?.background.url||"",n=e?.text?.content||"",o=e?.text?.style||{},i=(e?.default_coupon?.content,e?.default_coupon?.style||{}),a=e?.text_2?.content||"",r=e?.text_2?.style||{},l=e?.text_3?.style||{},s=e?.input?.content||"",c=e?.input?.style||{},d=e?.button?.content||"",m=e?.button?.style||{};return`\n  <div id="kariba_overlay_container">\n    <div id="kariba_default_code" class="show-class"\n      style="background: url(${t}) no-repeat;\n      background-size: cover;\n      background-position: center;"\n    >\n      <div id="kariba_input_container" class="kariba-default-code-container">\n        <div id="kariba_close_default_code" class="k-m-close-button">\n          <i class="material-icons">&#xe5cd;</i>\n        </div>\n        <span style="font-family: ${o.fontFamily||"Inter"}; \n                  color: ${o.color||"#FA541C"};\n                  font-size: ${o.fontSize||36}px;\n                  font-weight: ${o.fontStyle||"bold"};\n                  text-align: ${o.textAlign||"left"};\n                  width:262px;\n                  margin-bottom: 20px;\n        ">${n}</span>\n        <span style="font-family: ${i.fontFamily||"Inter"}; \n          color: ${i.color||"#FA541C"};\n          font-size: ${i.fontSize||20}px;\n          font-weight: ${i.fontStyle||"bold"};\n          text-align: ${i.textAlign||"center"};\n          width:262px;\n          ">20%</span>\n          \n        <span style="font-family: ${r.fontFamily||"Inter"}; \n          color: ${r.color||"#FA541C"};\n          font-size: ${r.fontSize||14}px;\n          font-weight: ${r.fontStyle||"bold"};\n          text-align: ${r.textAlign||"center"};\n          margin-bottom: 15px;\n          width:262px\n          ">${a}</span>\n        <input\n            id='kariba_minigame_email'\n            placeholder='${s||"Enter email"}'\n            style="font-family: ${c.fontFamily||"Inter"}; \n              color: ${c.color||"#000"};\n              font-size: ${c.fontSize||14}px;\n              font-weight: ${c.fontStyle||"nomal"};\n              text-align: ${c.textAlign||"center"};\n              width:262px;\n              height:40px;\n              border-radius:4px;\n              padding: 15px 10px;\n              border: 1px solid rgba(0, 0, 0, 0.15);\n              align-self: center;\n              border: 1px solid #CCC;"\n        />\n        <div \n          id="alert_email" \n          style="display:none;\n          font-family: ${l.fontFamily||"Inter"};\n          color: ${l.color||"#F5222D"};\n          font-size: ${l.fontSize||22}px;\n          font-weight: ${l.fontStyle||"normal"};\n          text-align: ${l.textAlign||"left"};\n          width:262px">Email bạn nhập vào không hợp lệ</div>\n        <button\n          id="receive_voucher"\n          style="font-family: ${m.fontFamily||"Inter"}; \n          background-color: ${m.backgroundColor||"#FA541C"};\n          color: ${m.color||"#FFF"};\n          font-size: ${m.fontSize||14}px;\n          font-weight: ${m.fontStyle||"nomal"};\n          text-align: ${m.textAlign||"center"};\n          width:262px;\n          height:40px;\n          border-radius:4px;\n          align-self: center;\n          border: none;\n          outline: none;\n          margin: 15px 0px;\n          font-weight:600;\n          cursor: pointer"\n        >${d}</button>\n        </div>\n      </div>`})(t);document.body.innerHTML+=o,p(e?.node_uuid),document.getElementById("kariba_default_code_minimize").addEventListener("click",(()=>{document.getElementById("kariba_default_code_minimize").className="hide-class",document.getElementById("kariba_overlay_container").className="show-class"})),document.getElementById("kariba_close_default_code").addEventListener("click",(()=>{var t;document.getElementById("kariba_default_code_minimize").className="show-class",t=e?.node_uuid,document.getElementById("kariba_overlay_container").className="hide-class",g(t,B)}));const i=document.getElementById("kariba_minigame_email");document.getElementById("receive_voucher").addEventListener("click",(async()=>{M();await(async(e,t)=>{if(!_(e))return T(),!1;try{const n=await h(e?.value,t);return 200===n.status?(M(),!0):(T(n?.msg?.detail),!1)}catch(e){return T(),!1}})(i,e?.node_uuid)&&C(e.data,e?.node_uuid,i)}))},D=()=>{document.getElementById("kariba_random_gift_minimize").className="hide-class"},L=({mainPopup:e,minimize:t})=>{const n=e?.background?.url||"",o=t?.text?.content||"",i=t?.text?.style||{},a=`\n  <div id="kariba_random_gift_minimize" class="hide-class"\n    style="background: url(${t?.background?.url||""}) no-repeat;\n      background-color:#F0F5FF;\n      background-size: cover;\n      background-position: center;">\n      <span\n      style="font-family: ${i.fontFamily||"Inter"}; \n        color: ${i.color||"#FA541C"};\n        font-size: ${i.fontSize||14}px;\n        font-weight: ${i.fontStyle||"bold"};"\n      >${o}</span>\n  </div>\n  <div id="kariba_overlay_container">\n    <div id="kariba_random_gift" class="show-class"\n      style="background: url(${n}) no-repeat;\n      background-size: cover;\n      background-position: center;\n      align-items: center;\n      justify-content: center;"\n    >\n      <div id="kariba_input_container"></div>\n    </div>\n  </div>`;document.body.innerHTML+=a,document.getElementById("kariba_random_gift_minimize").addEventListener("click",(()=>{document.getElementById("kariba_overlay_container").className="show-class",D()}))};let j;const N=(e,t)=>{const n=e?.background.url||"",o=e?.background.color,i=e.imgGift?.url||"",a=e?.text?.content||"",r=e?.text?.style||{},l=e?.text_1?.content||"",s=e?.text_1?.style||{},c=e?.text_2?.content||"",d=e?.text_2?.style||{},m=e?.button?.content||"",u=e?.button?.style||{},g="Confetti"==e?.background?.effects,p=`\n    <div id="kariba_result_container_result_random_gift" class="kariba-random-gift-result-container">\n      <div class="k-result-wrapper" style="background: url(${n}); background-color: ${o};">\n        <div id="kariba_close_random_gift" class="kariba-mingame-close-btn">\n          <i class="material-icons">&#xe5cd;</i>\n        </div>\n        <img style="margin-top: 16px" id="kariba_spin_gift_image" src=${i} alt="gift image" class="kariba-image-decorator"/>\n        <span style="font-family: ${r.fontFamily||"Inter"}; \n          color: ${r.color||"#FA541C"};\n          font-size: ${r.fontSize||36}px;\n          font-weight: ${r.fontStyle||"bold"};\n          text-align: ${r.textAlign||"center"};\n          margin-bottom: 16px;\n          margin-top: 10px;\n          ">${a}</span>\n          <span style="font-family: ${r.fontFamily||"Inter"}; \n          color: ${r.color||"#FA541C"};\n          font-size: ${r.fontSize||36}px;\n          font-weight: ${r.fontStyle||"bold"};\n          text-align: ${r.textAlign||"center"};\n          margin-bottom: 16px;\n          ">${t?.title}</span>\n\n        <span style="font-family: ${s.fontFamily||"Inter"}; \n          color: ${s.color||"#000000"};\n          font-size: ${s.fontSize||20}px;\n          font-weight: ${s.fontStyle||"bold"};\n          text-align: ${s.textAlign||"center"};\n          margin-bottom: 15px;\n          line-height: 24px;\n          ">${l}</span>\n\n        <span style="font-family: ${d.fontFamily||"Inter"}; \n          color: ${d.color||"#FA541C"};\n          font-size: ${d.fontSize||20}px;\n          font-weight: ${d.fontStyle||"bold"};\n          text-align: ${d.textAlign||"center"};\n          margin-bottom: 15px;\n          ">${c}</span>\n\n        <button\n          id="kariba_continue_shopping"\n          style="font-family: ${u.fontFamily||"Inter"}; \n          background-color: ${u.backgroundColor||"#FA541C"};\n          color: ${u.color||"#FFF"};\n          font-size: ${u.fontSize||12}px;\n          font-weight: ${u.fontStyle||"nomal"};\n          text-align: ${u.textAlign||"center"};"\n          >${m}\n        </button>\n        <canvas id="kariba_effect_canvas"></canvas>\n        <div id="effect_wrapper"></div>\n      </div>\n    </div>`;document.body.innerHTML+=p,j=(e=>{if(document.getElementById("kariba_result_container_result_random_gift"))if(e){const e=document.getElementById("kariba_effect_canvas");confetti.create(e,{resize:!0,useWorker:!0})({particleCount:100,spread:160})}else{const e=document.getElementById("effect_wrapper");j=new Fireworks(e),j.start()}})(g),document.getElementById("kariba_continue_shopping").addEventListener("click",(()=>{document.getElementById("kariba_result_container_result_random_gift")?.remove(),!g&&j&&j.stop()}))},H=e=>{document.getElementById("kariba_overlay_container").className="hide-class";g(e,(()=>{document.getElementById("kariba_random_gift_minimize")?.remove(),document.getElementById("kariba_overlay_container")?.remove()}))},O=(t={},n,o)=>{const i=y(),a=t?.mainPopup?.gift?.gifts||[],r=a[(l=0,s=a.length-1,Math.floor(Math.random()*(s-l+1)+l))];var l,s;N(t.result,r),u(e,{email:n,utm_s:t?.email?.emailData?.utm_source,utm_m:t?.email?.emailData?.utm_medium,utm_c:t?.email?.emailData?.utm_campaign,coupon:r.code,node_uuid:o,popup_t:1});const c={tracking_id:i,node_uuid:o,coupon_code:r.code,email:n};submitMinigame(c)},R=(e={},t)=>{const{mainPopup:n}=e,o=n?.imgGift?.url||"",i=(n?.imgGifts?.url,n?.text?.content||""),a=n?.text?.style||{},r=n?.text_1?.content||"",l=n?.text_1?.style||{},s=n?.text_2?.content||"",c=n?.text_2?.style||{},d=n?.input?.content||"",m=n?.input?.style||{},u=(n?.button?.content,n?.button?.style,n?.email?.style||{}),g=`\n      <div id="kariba_input_container" style="\n        width: 336px;\n        min-height: 408px;\n        background-color: #F0F5FF;\n        align-self: center;\n        justify-self:center;\n        position:absolute"\n      >\n        <div id="kariba_close_random_gift" style="\n          color: #6C6C6C; \n          font-size: 20px;\n          cursor: pointer;\n          justify-self:center;\n          top: 12px;\n          right: 18px;\n          position: absolute;"\n        ><i class="material-icons">&#xe5cd;</i></div>\n        <img src=${o} alt="gift image" class="kariba-image-decorator" />\n        <span style="font-family: ${a.fontFamily||"Inter"}; \n            color: ${a.color||"#FA541C"};\n            font-size: ${a.fontSize||36}px;\n            font-weight: ${a.fontStyle||"bold"};\n            text-align: ${a.textAlign||"left"};\n            line-height: 36px;\n        ">${i}</span>\n        <span style="font-family: ${l.fontFamily||"Inter"}; \n          color: ${l.color||"#FA541C"};\n          font-size: ${l.fontSize||20}px;\n          font-weight: ${l.fontStyle||"bold"};\n          text-align: ${l.textAlign||"left"};\n          margin-bottom: 12px;\n          ">${r}</span>\n          \n        <span style="font-family: ${c.fontFamily||"Inter"}; \n          color: ${c.color||"#FA541C"};\n          font-size: ${c.fontSize||14}px;\n          font-weight: ${c.fontStyle||"bold"};\n          text-align: ${c.textAlign||"center"};\n          margin-bottom: 8px;\n          ">${s}</span>\n        <input\n          id='kariba_minigame_email'\n          placeholder='${d||"Enter email"}'\n          style="font-family: ${m.fontFamily||"Inter"}; \n            color: ${m.color||"#000"};\n            font-size: ${m.fontSize||14}px;\n            font-weight: ${m.fontStyle||"nomal"};\n            text-align: ${m.textAlign||"left"};\n            width:262px;\n            height:40px;\n            border-radius:4px;\n            padding: 9px 15px;\n            border: 1px solid rgba(0, 0, 0, 0.15);\n            align-self: center;\n            border: 1px solid #CCC;"\n        />\n          <div \n            id="alert_email" \n            style="width: 264px;\n            font-family: ${u.fontFamily||"Inter"};\n            color: ${u.color||"#F5222D"};\n            font-size: ${u.fontSize||22}px;\n            font-weight: ${u.fontStyle||"normal"};\n            text-align: ${u.textAlign||"left"};\n            display:none; \n            padding-right:42px; \n            align-self: center;">Email bạn nhập vào không hợp lệ</div>\n          ${(e=>{if(!e)return;return`<div class="kariba-gift-wrapper">${e.map((()=>'<img src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALFSURBVHgB7VbBbtpAEB3bqGeqXithuFW9cGxvDnAnkVqpt8AXpKgf0PAFNF8QODdVyaknMMfe4vwA3kr9AM6RwH0Tr1tD67WpXG2J9kmrtZfZN2/GsztYVACe51Vt2+5ZltXFaxOjyut4D6IoCvB4PZvNprQHwOlVKpUu9jOfK/lWzLderycLoAiPVcSR4ziXiRMFBMYCzofwLbKMWq0WJ+KM4kSoMAbXAFwrlZGt+rHdbh9DvE+x+AWy0wdpHdm2MD+GkCOsDfBbIG16bA+Rb3e5kAcXfD72cDKa2MfCLjBOmJNHwochJNcl5SDzC7DDRDwIh/P5/JwU6HQ6Hux6eDyVS1OI6nMGwdWUXFUpfAC+sco3SvYGAbG9C9tvWbZO1g+NRuMYBD08LkDQpxwsl0sRhuG0Xq+zsyb2voCIN7Va7Rbiv1B8bqabzebI9/2vKi4hxMp13Wfg4DK7BW+QZZtZQojck/M17QHOLIuUZeCmMj9E6Z3k1fRPYbZd4xlcQmlH+SjkMA0+xDKIZO8irwTT4BLiiZOQdxtlBsBXpJxP6e9Q5Rr+peleVC5SZ48xybPPDAAZHMsMen+6VXKJbdtLv0NULgeLR2/4TPHFIYp8tcwAZK0O+RmZHCGI97QHZINiJA2uq7JPbirex+K5BKkAlGcAGfgA8UkQ57jHQ3ZEBcBdtYgdd3lODsTfUNxLAhavaoZbfooYcUNDVkYQ5colbmoTOJpm3SqyL/ippTFuoX5aOMrsDJxcWslZuYDNXuVq3X16EmJy6SARCftwxTMst0gf+K9hAtANE4Bu2HwV0cEiEr81srtXTyMqCc7rwf28/jiisvDo6vuWZnMGdMMEoBsmAN0wAeiGCUA3KrsLSfsvA9bzlzEnlYird1uvD+8LlPnHy/kHnLswh1g3TAC6YQLQDROAbpgAdMMEoBsmAN34AdYURJ2ZkxB7AAAAAElFTkSuQmCC alt="gift image" class="kariba-gift-item"/>')).join("")}</div>`})(n?.gift?.gifts)}\n        </div>`;document.getElementById("kariba_input_container").innerHTML+=g,p(t),document.getElementById("kariba_close_random_gift").addEventListener("click",(()=>{document.getElementById("kariba_random_gift_minimize").className="show-class",H(t)}));const f=document.getElementById("kariba_minigame_email");document.addEventListener("click",(async function(n){if("kariba-gift-item"===n.target.className){Z();if(!await G(f,t))return;n.target.classList.add("kariba-swing"),setTimeout((()=>{D(),H(),O(e,f?.value,t)}),1700)}}))},U=e=>{let t=document.getElementById("alert_email");t.style.display="block",t.textContent=e||"Email không hợp lệ"},Z=()=>{document.getElementById("alert_email").style.display="none"},G=async(e,t)=>{if(!_(e))return U(),!1;try{const n=await h(e?.value,t);return 200===n.status?(Z(),!0):(U(n?.msg?.detail),!1)}catch(e){return U(),!1}},K=e=>{if(!e)return;if(!f(e?.node_uuid))return;(async()=>{await x(10,e?.node_uuid)&&(L(e),R(e?.data,e?.node_uuid))})()},W=[{url:"https://storage.googleapis.com/kariba-public/juno/winwheel/Winwheel.min.js",type:"script"},{url:"https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js",type:"script"},{url:"https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit",type:"script"},{url:"https://cdn.jsdelivr.net/npm/fireworks-js@latest/dist/fireworks.js",type:"script"},{url:"https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js",type:"script"},{url:"https://storage.cloud.google.com/dreamf-mcm-public-storage/assets/css/kariba.css",type:"style"}],J=function(){W.forEach((e=>{let t;if("script"===e.type)t=document.createElement("script"),t.type="text/javascript",t.src=e.url,t.id=e.id||(new Date).getTime();else{if("style"!==e.type)return;t=document.createElement("link"),t.rel="stylesheet",t.type="text/css",t.href=e.url}document.head.appendChild(t)}))};void 0!==typeof window&&(window.Kariba=function(e={}){let m={};const g="BEJ74vEMyGt-upirbJPgoBa3rqgUcT_jibxJtgt8F3qss4s-LdH2UcgqUK19KgNbKD_ypY9yFWwzTp2nz-IzMBM",p={apiKey:"AIzaSyD3W9wCis2pqWAxVlFgyC73CI8_M3nsivQ",authDomain:"kariba-juno-147b1.firebaseapp.com",projectId:"kariba-juno-147b1",storageBucket:"kariba-juno-147b1.appspot.com",messagingSenderId:"725492603698",appId:"1:725492603698:web:9698add9fc0f21c107552b",measurementId:"G-8BNNZGRS1H"},f="https://juno.vn/apps/hrvsw/kariba-sdk.js";let _,b,x=(document.addEventListener("touchstart",(function(){document.body.classList.add("mobile-detected")})),document.getElementsByTagName("body")[0].classList.contains("mobile-detected")),k=navigator.platform.indexOf("Mac")>-1,h=x?c:d,v=e.level||"medium";function w(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function $(){return w()}function I(e=r){return sessionStorage.getItem(e)}function S(e,t="true"){return sessionStorage.getItem(e)===t}function A(e,t=!0){return sessionStorage.setItem(e,t)}function E(e,n=30){let o=((e=1)=>{let t=24*e*60*60*1e3,n=new Date;return n.setTime(n.getTime()+t),"; expires="+n.toUTCString()})(n),i=e||t;document.cookie=i+"=true"+o}function z(e){return B(e||t,"true")}const B=function(e,t){return function(){let e=document.cookie.split("; "),t={};for(let n=e.length-1;n>=0;n--){let o=e[n].split("=");t[o[0]]=o[1]}return t}()[e]===t},C=function(e=""){u("11",e)},T=function(){fetch("https://be.juno.kariba.ai/api/v1/action-triggers/public/welcome_push?channel=toast").then((function(e){e.json().then((e=>{e.value&&sessionStorage.setItem(n,e.value.htmlTemplate)}))}))};async function M(e){function t(e){return new Promise((function(t,n){if(M.loaded.has(e))t();else{var o=document.createElement("script");o.onload=t,o.src=e,document.head.appendChild(o)}}))}var n=[];for(const o of e)n.push(t(o));await Promise.all(n);for(const t of e)M.loaded.add(t)}const D=()=>{M.loaded=new Set,M(["https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"]).then(M(["https://www.gstatic.com/firebasejs/8.2.1/firebase-messaging.js"]).then((()=>{try{firebase.initializeApp(p),L()}catch(e){console.log("load_scripts firebase Error: ",e)}})))},L=async()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register(f).then((async e=>{const t=firebase.messaging();t.onMessage((function(t){const n=t.notification;e.showNotification(n.title?n.title:"",n)}));const n=await t.getToken({serviceWorkerRegistration:e,vapidKey:g});var o;o=n,S(l)||(A(l),hoian.signal("10",[{bs_token:o}]))})).catch((e=>{A(l,!1),console.log("Get Firebase token failed: ",e)}))},j=async()=>{if(z("welcome_push"))return;"granted"===await Notification.requestPermission()&&(E("welcome_push",365),H({timeout:5e3,contentHtml:sessionStorage.getItem(n)}))};function N(e){clearTimeout(m[e]);const t=document.querySelector(`[kariba_toast_uuid="${e}"]`);t.className=t.className.replace("show","")}const H=function(e={}){let t=w(),n=e.timeout||5e3,o=e.duration||1e4,i=e.contentHtml;if(!i)return;let a=`<div \n                  id="kariba_toast" \n                  kariba_toast_uuid=${t} \n                  onclick="window._karibaToastOnClick('${t}')">\n                    <span class="close-btn" \n                      style="position: absolute;\n                      z-index: 19091991;\n                      top: -5px;\n                      right: -5px;\n                      background: red;\n                      border-radius: 50%;\n                      width: 20px;\n                      height: 20px;\n                      color: #333333;\n                      background-color: #ffffff;\n                      display: flex;\n                      font-size: 11px;\n                      font-weight: bold;\n                      justify-content: center;\n                      align-items: center;\n                      border: 1px solid #eeeeee;\n                      cursor: pointer;"\n                    >&#x2715</span>\n                    ${i}\n                </div>`,r=document.getElementById("kariba_toast");r||(document.body.innerHTML=document.body.innerHTML+a),r=document.getElementById("kariba_toast"),setTimeout((function(){r.className=k?"show":"bottom-right show"}),n),m[t]=setTimeout((function(){r.className=r.className.replace("show","")}),n+o)},O=function(e={}){let t=e.contentHtml||"No HTML",n=e.timeout||700,o=`<div id="Kariba_Popup" class="kariba-modal">                  <div class="kariba-modal-content" >\n                    <span class="close-icon">&times;</span>                    ${t}\n                  </div>\n                </div>`,i=document.getElementById("Kariba_Popup");i||(document.body.innerHTML=document.body.innerHTML+o),i=document.getElementById("Kariba_Popup"),document.querySelector("#Kariba_Popup .close-icon").onclick=function(){i.style.setProperty("display","none","important")},window.onclick=function(e){e.target==i&&i.style.setProperty("display","none","important")},setTimeout((function(){i.style.display="block"}),n||2e3)};function R(e){let t=h[v].scrolling.sensibility,n=h[v].scrolling.comparator;let o=function(){let e,t,n,o;function i(){e=null,o=0}return i(),function(){return t=window.scrollY,null!=e&&(o=t-e),e=t,clearTimeout(n),n=setTimeout(i,50),o}}();window.addEventListener("scroll",(function(){S(I())||(b=o(),console.log("scrollSpeed",b),x&&"<"===n&&b<t?(G({contentHtml:e.htmlTemplate,timeout:1500},"fast_scroll"),C("fast_scroll"),A(I())):">"===n&&b>t&&(C("fast_scroll"),G({contentHtml:e.htmlTemplate,timeout:1500},"fast_scroll"),A(I())))}))}function U(e){setInterval((function(){sessionStorage.setItem(o,document.hidden);const t=sessionStorage.getItem(o),n=sessionStorage.getItem(i);"true"===t&&"false"===n&&function(e){S(I())||(A(I()),sessionStorage.setItem(i,"true"),G({contentHtml:e.htmlTemplate,timeout:10},"change_tab"),C("change_tab"))}(e)}),1e3)}function Z(e){document.documentElement.addEventListener("mouseleave",(t=>function(e,t){h[v].mouseOutViewPort.callback;let n=h.sensibility||10;e.clientY>n||S(I())||(A(I()),G({contentHtml:t.htmlTemplate},"mouse_leave"),C("mouse_leave"))}(t,e)))}function G(e={},t){t&&(O(Object.assign(e)),function(e){try{let t=JSON.parse(sessionStorage.getItem(a));if(!t)return;let n=t.findIndex((t=>t.key===e));t[n].viewed=!0,sessionStorage.setItem(a,JSON.stringify(t))}catch(e){return!1}}(t),u("12",t),localStorage.setItem("TimeReceivedPopup",Date.now()))}function W(e){const t=sessionStorage.getItem("isVisitSalePage");parseInt(t)||(x?R(e):(R(e),Z(e)),U(e))}const V=async()=>{const e=await async function(){try{const e=y(),t=await fetch("https://be.juno.kariba.ai/api/v1/action-triggers/public/minigame?tracking_id="+e);if(!t.ok)throw new Error(`Failed to fetch data: ${t.status}`);return t.json()}catch(e){console.log(e)}}(),t=await async function(){try{const e=y(),t=await fetch("https://be.juno.kariba.ai/api/v1/action-triggers/public/popup?tracking_id="+e);if(!t.ok)throw new Error(`Failed to fetch data: ${t.status}`);return t.json()}catch(e){console.log(e)}}(),n=window.location.pathname.split("/")[2];if(!["he-thong-cua-hang","flash-sale-quan-ao","flash-sale-quan-ao-40","flash-sale-quan-ao-30"].includes(n)){if(e){const t=localStorage.getItem("CUSTOMER_JOURNEY_ID"),n=parseInt(localStorage.getItem("TimeReceivedPopup")),o=e.customer_journey_id;if(t==o){if(n&&Date.now()<n+s)return;switch(e?.popupType){case"default_code":P(e);break;case"random_gift":K(e);break;case"spin_game":F(e)}}else switch(localStorage.setItem("CUSTOMER_JOURNEY_ID",o),e?.popupType){case"default_code":P(e);break;case"random_gift":K(e);break;case"spin_game":F(e)}}if(t){const e=localStorage.getItem("CUSTOMER_JOURNEY_ID"),n=parseInt(localStorage.getItem("TimeReceivedPopup")),o=t.customer_journey_id;if(e==o){if(n&&Date.now()<n+s)return;W(t)}else localStorage.setItem("CUSTOMER_JOURNEY_ID",o),W(t)}}};return void 0===_&&(_=new function(){return J(),T(),V(),window._karibaToastOnClick=N,window.onload=function(){D(),I()||function(e=r){sessionStorage.setItem(e,$())}(),j(),sessionStorage.setItem(i,!1)},{isMobile:x,showModal:O,showToast:H,requestNotiPerm:j,initFirebase:D,getWelcomePushContent:T,showPopup:G,generateSessionId:$,getSessionId:I,isDisabled:z}},_.__DEV__=!1,delete _.constructor),_})})();
//# sourceMappingURL=kariba.js.map